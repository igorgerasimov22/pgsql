# PostgreSQL Configuration Management

Этот проект содержит Ansible playbooks и конфигурационные файлы для настройки и управления PostgreSQL в окружении с репликацией и резервным копированием.

## Описание

Проект предоставляет автоматизацию для настройки PostgreSQL серверов с использованием Ansible, включая следующие функции:

- Настройка основной и резервной репликации PostgreSQL.
- Управление конфигурационными файлами PostgreSQL.
- Настройка Barman для резервного копирования PostgreSQL.
  
## Структура проекта

- `ansible/`: Директория, содержащая playbooks и шаблоны конфигурации.
  - `setup_master.yml`: Playbook для настройки основного PostgreSQL сервера.
  - `setup_slave.yml`: Playbook для настройки резервного PostgreSQL сервера.
  - `setup_barman.yml`: Playbook для настройки Barman для резервного копирования.
  - `templates/`: Директория с шаблонами конфигурационных файлов PostgreSQL (`postgresql.conf`, `pg_hba.conf`, `recovery.conf`, `barman.conf`).

  # Настройка PostgreSQL Master

Этот Ansible playbook настраивает основной сервер PostgreSQL в сети. Он устанавливает необходимые пакеты, инициализирует базу данных, настраивает конфигурационные файлы и создает слоты репликации для обеспечения репликации.

## Описание Playbook

### Основные функции

- **Установка PostgreSQL**: Устанавливает сервер PostgreSQL с использованием пакетного менеджера `yum`.
- **Инициализация базы данных**: Настраивает начальную базу данных PostgreSQL.
- **Копирование конфигурационных файлов**:
  - Копирует файл конфигурации PostgreSQL (`postgresql.conf`) из шаблона.
  - Копирует файл конфигурации для аутентификации (`pg_hba.conf`) из шаблона.
- **Запуск и включение PostgreSQL**: Запускает службу PostgreSQL и включает ее автозагрузку при старте системы.
- **Создание директории для резервного копирования**: Создает директорию для хранения архивов резервных копий.
- **Настройка репликации**: Создает физический слот репликации для обеспечения работы репликации.

### Пример использования

1. Убедитесь, что у вас установлен Ansible.
2. Настройте файл инвентаризации Ansible, добавив сервер `postgres_master` в соответствующую группу.
3. Запустите playbook с помощью следующей команды:

```bash
   ansible-playbook setup_master.yml
```

# Настройка PostgreSQL Slave

Этот Ansible playbook настраивает резервный сервер PostgreSQL в сети. Он устанавливает необходимые пакеты, инициализирует базу данных, настраивает конфигурационные файлы и создает слоты репликации для обеспечения репликации от основного сервера.

## Описание Playbook

### Основные функции

- **Установка PostgreSQL**: Устанавливает сервер PostgreSQL с использованием пакетного менеджера `yum`.
- **Инициализация базы данных**: Настраивает начальную базу данных PostgreSQL.
- **Копирование конфигурационных файлов**:
  - Копирует файл конфигурации PostgreSQL (`postgresql.conf`) из шаблона.
  - Копирует файл конфигурации для аутентификации (`pg_hba.conf`) из шаблона.
  - Копирует файл конфигурации восстановления (`recovery.conf`) для настройки слейва.
- **Запуск и включение PostgreSQL**: Запускает службу PostgreSQL и включает ее автозагрузку при старте системы.
- **Настройка репликации**: Создает физический слот репликации для обеспечения работы репликации от основного сервера.

### Пример использования

1. Убедитесь, что у вас установлен Ansible.
2. Настройте файл инвентаризации Ansible, добавив сервер `postgres_slave` в соответствующую группу.
3. Запустите playbook с помощью следующей команды:

```bash
   ansible-playbook setup_slave.yml
```


# Настройка Barman для резервного копирования PostgreSQL

Этот Ansible playbook настраивает Barman, инструмент для резервного копирования PostgreSQL. Он устанавливает необходимые пакеты, настраивает конфигурацию и обеспечивает создание каталогов для хранения резервных копий.

## Описание Playbook

### Основные функции

- **Установка необходимых пакетов**: Устанавливает Barman и OpenSSH-сервер с использованием менеджера пакетов `yum`.
- **Создание конфигурационной директории Barman**: Создает директорию для хранения конфигурационных файлов Barman.
- **Копирование конфигурационного файла Barman**: Копирует файл конфигурации из шаблона в директорию конфигурации Barman.
- **Создание пользователя Barman**: Убедитесь, что пользователь `barman` существует на сервере.
- **Создание каталога для резервных копий**: Создает каталог для хранения резервных копий PostgreSQL с необходимыми правами доступа.
- **Запуск и включение службы Barman**: Запускает службу Barman и включает ее автозагрузку при старте системы.

### Пример использования

1. Убедитесь, что у вас установлен Ansible.
2. Настройте файл инвентаризации Ansible, добавив сервер `barman_server` в соответствующую группу.
3. Запустите playbook с помощью следующей команды:

```bash
   ansible-playbook setup_barman.yml
```